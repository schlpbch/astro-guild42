# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Guild42 is a static website for a software engineering community in Berne, Switzerland. Built with Astro 5, React, Tailwind CSS, and TypeScript. Deployed to Netlify at guild42.ch.

## Commands

```bash
pnpm dev              # Local dev server
pnpm build            # Production build (astro build + jampack optimization)
pnpm preview          # Preview production build locally
pnpm lint             # ESLint
pnpm format:check     # Prettier check
pnpm format           # Prettier fix
pnpm sync             # Sync Astro content collections
pnpm cz               # Commitizen for conventional commit messages
```

Package manager is **pnpm** (v10.22).

## Architecture

### Content & Collections

- **Events**: Markdown files in `src/content/events/`. Schema defined in `src/content/config.ts` with Zod validation.
  - Fields: `author`, `speakers` (array), `pubDatetime`, `modDatetime` (optional), `title`, `topics` (array), `description`, `tags` (default: "others"), `draft` (optional, excludes from publishing), `upcoming` (optional, boolean for future events), `ogImage` (optional, min 1200×630px), `canonicalURL` (optional).
  - Naming convention: `YYYY_MM_DD_Title.md`
  - Set `draft: true` to exclude from builds; set `upcoming: true` for scheduled future events.

- **Surveys**: Data-driven content in `src/data/surveys/` with schemas defined in `src/config/survey-schemas.ts`. Includes utilities for processing survey data in `src/utils/survey/`.

### Pages & Routing

- **File-based routing**: `src/pages/` with Astro's standard routing.
- **Dynamic event pages**: `src/pages/events/[slug]/index.astro` renders individual events.
- **OG image generation**: `src/pages/events/[slug]/index.png.ts` generates social preview images at build time using satori + resvg-js.

### Layouts & Components

- **Layouts**: `Layout.astro` (base HTML), `Events.astro` (event list page), `EventDetails.astro` (single event detail).
- **Components**: Reusable UI components in `src/components/`. Notable ones: `Header.astro`, `Footer.astro`, `Hero.astro`, `Card.tsx` (React), `Sponsors.astro`, `CodeWindow.astro`.
- **Styling**: Tailwind CSS with custom CSS variable-based theming (colors: base, accent, inverted, card, card-muted). Dark/light mode supported via `lightAndDarkMode` in `src/config.ts`. Font: IBM Plex Mono. Typography plugin styles markdown content.

### Configuration & Utilities

- **Site config**: `src/config.ts` contains `SITE` metadata, `PATRONS` (with categories: Life, Universe, Member42), `COMMUNITY` (partner groups), `SOCIALS`, and `LOCALE`.

- **Utilities** (`src/utils/`):
  - Event manipulation: `getSortedPastEvents`, `getSortedForthcomingEvents`, `getEventsByTopic`, `getUniqueTopics`, `eventFilter`.
  - Pagination: `getPagination`, `getPageNumbers`.
  - RSS: `rss-item-builder.ts`, `rss-image-resolver.ts`.
  - JSON-LD: `generate-jsonld.ts` (SEO structured data).
  - URL building: `url-builder.ts`.
  - Survey utilities: `src/utils/survey/` (data processing).

- **Scripts**:
  - `src/scripts/pdf-carousel-client.js`: Client-side PDF carousel functionality.
  - `src/scripts/performance-monitoring.js`: Page performance tracking.

### URL Handling

- **Redirects**: Defined in `astro.config.ts` (e.g., `/event/java-vs-python` → `/events/why-python-is-so-popular`).
- **Sitemaps**: Auto-generated by `@astrojs/sitemap` integration.
- **RSS feed**: Available at `/rss.xml` (built from events).

## Path Aliases (tsconfig)

Import paths: `@assets/*`, `@components/*`, `@config`, `@content/*`, `@layouts/*`, `@pages/*`, `@styles/*`, `@utils/*` all resolve to `src/<name>/*`.

## Adding a New Event

1. Create a markdown file in `src/content/events/` following the naming convention `YYYY_MM_DD_Title.md`.
2. Add frontmatter with required fields: `author`, `speakers`, `pubDatetime`, `title`, `topics`, `description`.
3. Optionally set `draft: true` to exclude from publishing or `upcoming: true` for scheduled events.
4. Provide an OG image at least 1200×630px as `ogImage` (can be a relative path to an image in assets or a URL string).
5. Save the markdown content below the frontmatter.

## Build Pipeline

- **Development**: `pnpm dev` starts Astro dev server with hot reload.
- **Production**: `pnpm build` runs Astro build, then **jampack** optimizes the output (minifies, optimizes assets, compresses images). No separate jampack command needed.
- **Preview**: `pnpm preview` serves the production build locally (requires prior `pnpm build`).

## Pre-commit & Commits

- **Husky + lint-staged**: Automatically runs Prettier on staged files before commits. Linting fixes get committed automatically.
- **Commitizen**: Use `pnpm cz` for interactive conventional commit message creation (recommended but optional).

## Notable Implementation Details

- **Jampack integration**: Runs after `astro build`. Handles minification, asset optimization, and image compression. Part of the build output, not a separate step.
- **Markdown processing**: Remark plugins (`remark-toc`, `remark-collapse`) auto-generate table of contents in event content.
- **Shiki syntax highlighting**: Code blocks in markdown use "one-dark-pro" theme with line wrapping enabled.
- **React components**: Astro components can import React components via `@astrojs/react` integration for interactive UI elements.
